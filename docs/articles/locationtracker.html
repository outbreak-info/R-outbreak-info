<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Location Tracker • outbreakinfo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Location Tracker">
<meta property="og:description" content="outbreakinfo">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-VK9KSJ8ENE"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VK9KSJ8ENE');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">outbreakinfo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/outbreakinfo.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/epivignette.html">Cases &amp; Deaths data</a>
    </li>
    <li>
      <a href="../articles/locationtracker.html">Location Tracker</a>
    </li>
    <li>
      <a href="../articles/researchlibrary.html">Research Library</a>
    </li>
    <li>
      <a href="../articles/varianttracker.html">Variant Tracker</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/outbreak-info/R-outbreak-info/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="locationtracker_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="locationtracker_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="locationtracker_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Location Tracker</h1>
            
            <h4 class="date">17 May 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/outbreak-info/R-outbreak-info/blob/master/vignettes/locationtracker.Rmd"><code>vignettes/locationtracker.Rmd</code></a></small>
      <div class="hidden name"><code>locationtracker.Rmd</code></div>

    </div>

    
    
<div id="accessing-the-data-in-outbreak-infos-location-tracker" class="section level1">
<h1 class="hasAnchor">
<a href="#accessing-the-data-in-outbreak-infos-location-tracker" class="anchor"></a>Accessing the data in outbreak.info’s Location Tracker</h1>
<p>outbreak.info’s Location Tracker allows you to explore what lineages are currently circulating within a particular country, state/province, or U.S. county. These reports also allow you to compare the prevalence of variants within that location, including Variants of Concern. Here, we’ll show you how to pull the data from these reports and recreate the visualizations on the <a href="https://outbreak.info/location-reports?loc=USA">United States Variant Report</a>.</p>
<div id="before-we-start" class="section level2">
<h2 class="hasAnchor">
<a href="#before-we-start" class="anchor"></a>Before we start…</h2>
<p>Import the packages we’ll use and provide our GISAID credentials to access the data. If you don’t have a GISAID account, you can <a href="https://www.gisaid.org/registration/register/">register</a> for one on their website. It may take a day or two for the account to become active.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Package imports</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: package 'dplyr' was built under R version 4.0.5</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://outbreak-info.github.io/R-outbreak-info/">outbreakinfo</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: replacing previous import 'jsonlite::flatten' by 'purrr::flatten' when
## loading 'outbreakinfo'</code></pre>
<pre><code>## Warning: replacing previous import 'ggplot2::%+%' by 'crayon::%+%' when loading
## 'outbreakinfo'</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Authenticate yourself using your GISAID credentials.</span>
<span class="fu"><a href="../reference/authenticateUser.html">authenticateUser</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="what-lineages-are-circulating-within-the-location" class="section level2">
<h2 class="hasAnchor">
<a href="#what-lineages-are-circulating-within-the-location" class="anchor"></a>What lineages are circulating within the location?</h2>
<div id="accessing-the-data-prevalence-of-all-circulating-lineages-in-the-u-s-" class="section level3">
<h3 class="hasAnchor">
<a href="#accessing-the-data-prevalence-of-all-circulating-lineages-in-the-u-s-" class="anchor"></a>Accessing the data: prevalence of all circulating lineages in the U.S.</h3>
<p>To be able to discover which lineages are currently circulating around the U.S., let’s grab the prevalence of all the lineages in the U.S. over the past 60 days.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">locationName</span> <span class="op">=</span> <span class="st">"United States"</span>
<span class="va">usa_60d</span> <span class="op">=</span> <span class="fu"><a href="../reference/getAllLineagesByLocation.html">getAllLineagesByLocation</a></span><span class="op">(</span>location <span class="op">=</span> <span class="va">locationName</span>, other_threshold <span class="op">=</span> <span class="fl">0.03</span>, nday_threshold <span class="op">=</span> <span class="fl">5</span>, ndays <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This ends up being a large data frame. Let's take a look at what's inside:</span>
<span class="va">usa_60d</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 2,216
## Columns: 6
## $ date               &lt;date&gt; 2020-01-26, 2020-01-27, 2020-01-28, 2020-01-29, 20…
## $ total_count        &lt;int&gt; 3, 1, 2, 4, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, …
## $ lineage_count      &lt;int&gt; 3, 1, 2, 4, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, …
## $ lineage            &lt;chr&gt; "other", "other", "other", "other", "other", "other…
## $ prevalence         &lt;dbl&gt; 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, …
## $ prevalence_rolling &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</code></pre>
<p>You can get explanations of each of the variables by looking at the data dictionary (<code><a href="../reference/genomicsDataDictionary.html">outbreakinfo::genomicsDataDictionary()</a></code>). Let’s look at how prevalent each of the different Pango lineages are in the U.S.:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_60d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">lineage</span> <span class="op">!=</span> <span class="st">"other"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">lineage</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">prevalence_rolling</span><span class="op">)</span>,
            max_prevalence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">prevalence_rolling</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">max_prevalence</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">lineage</th>
<th align="right">min_prevalence</th>
<th align="right">max_prevalence</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ba.1.1</td>
<td align="right">0.00e+00</td>
<td align="right">0.6575094</td>
</tr>
<tr class="even">
<td align="left">ba.2</td>
<td align="right">1.08e-05</td>
<td align="right">0.4787350</td>
</tr>
<tr class="odd">
<td align="left">ba.2.12.1</td>
<td align="right">0.00e+00</td>
<td align="right">0.3860000</td>
</tr>
<tr class="even">
<td align="left">ba.2.3</td>
<td align="right">0.00e+00</td>
<td align="right">0.1000000</td>
</tr>
<tr class="odd">
<td align="left">ba.2.12</td>
<td align="right">0.00e+00</td>
<td align="right">0.0706667</td>
</tr>
<tr class="even">
<td align="left">ba.2.9</td>
<td align="right">0.00e+00</td>
<td align="right">0.0682952</td>
</tr>
</tbody>
</table>
</div>
<div id="plotting-the-breakdown-of-lineages-in-the-u-s--over-time" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-the-breakdown-of-lineages-in-the-u-s--over-time" class="anchor"></a>Plotting the breakdown of lineages in the U.S. over time</h3>
<p>That gives an idea of what the range of prevalences for the lineages are, but not how they have changed over time. It’s easier to see this temporal behavior with a streamgraph which plots the relative prevalence of all the lineages over time. <code>plotAllLineagesByLocation</code> replicates these plots on outbreak.info:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotAllLineagesByLocation.html">plotAllLineagesByLocation</a></span><span class="op">(</span><span class="va">locationName</span>, other_threshold <span class="op">=</span> <span class="fl">0.03</span>, nday_threshold <span class="op">=</span> <span class="fl">5</span>, ndays <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></code></pre></div>
<pre><code>## Retrieving data... 
## Plotting data...</code></pre>
<p><img src="locationtracker_files/figure-html/all_lineages_streamgraph-1.png" width="700"></p>
</div>
<div id="modifying-the-parameters-to-group-lineages-into-the-other-category" class="section level3">
<h3 class="hasAnchor">
<a href="#modifying-the-parameters-to-group-lineages-into-the-other-category" class="anchor"></a>Modifying the parameters to group lineages into the Other category</h3>
<p>One thing that pops out is that there’s a big group of lineages which are grouped into an “other” category. As of October 2021, there are over 800 separate Pango lineages which have been found in the U.S. – way too many to plot . The parameters in <code>getAllLineagesByLocation</code> and <code>plotAllLineagesByLocation</code> group the smaller lineages into this “other” category. Let’s break down how these parameters work:</p>
<ul>
<li>
<code>other_threshold</code> is the minimum prevalence threshold for the lineage not to be grouped into “other”</li>
<li>
<code>nday_threshold</code> is the number of days which that threshold must be met not to be grouped into “other”</li>
<li>
<code>ndays</code> is the window before the current date where to look to group lineages into “other”</li>
</ul>
<p>… so for the example we ran before, we grouped all lineages which did not have a prevalence of at least 3% (<code>other_threshold = 0.03</code>) in at least 5 days (<code>nday_threshold = 5</code>) over the last 60 days (<code>ndays = 60</code>). If we want to look at more historic data, we can adjust these parameters. Let’s change the window to the last year (<code>ndays = 365</code>) and find all lineages which had a prevalence of at least 5% (<code>other_threshold = 0.05</code>) in 5 days (<code>nday_threshold = 5</code>) in that year. We can also make sure certain lineages, like A.1 which was circulating early on in the pandemic, are not grouped into the “other” category by specifying <code>other_exclude = "a.1"</code>.</p>
<p>It’s easy then to see the trends over the last year – the North American lineages B.1 and B.1.2 appearing in 2020, the emergence of the California variants (B.1.427/B.1.429/Epsilon) and the New York variant (B.1.526/Iota) in early 2021, the rise of B.1.1.7/Alpha in the Spring of 2021, and Delta (B.1.617.2 + AY-lineages) outcompeting all lineages in summer 2021:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotAllLineagesByLocation.html">plotAllLineagesByLocation</a></span><span class="op">(</span><span class="va">locationName</span>, other_threshold <span class="op">=</span> <span class="fl">0.05</span>, nday_threshold <span class="op">=</span> <span class="fl">5</span>, ndays <span class="op">=</span> <span class="fl">365</span>, other_exclude <span class="op">=</span> <span class="st">"a.1"</span><span class="op">)</span></code></pre></div>
<pre><code>## Retrieving data... 
## Plotting data...</code></pre>
<p><img src="locationtracker_files/figure-html/all_lineages_streamgraph_overload-1.png" width="700"></p>
</div>
<div id="remember-these-are-just-estimates" class="section level3">
<h3 class="hasAnchor">
<a href="#remember-these-are-just-estimates" class="anchor"></a>Remember: these are just estimates</h3>
<p>One essential thing to note is that while these streamgraphs are great for looking at the breakdown of lineages within a location over time, they’re <strong>rubbish at showing the uncertainty associated with these estimates</strong>. In particular, the estimates of how much lineage is in a location recently tends to be more unreliable, just because not as many samples have been sequenced lately. We’ll plot that in the next section. There are also other <a href="https://outbreak.info/situation-reports/caveats">sources of bias</a> that are harder to estimate, but you should bear in mind when you’re looking at any prevalence plots of variants.</p>
</div>
</div>
<div id="comparing-the-prevalence-of-specific-lineages-within-a-location" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-the-prevalence-of-specific-lineages-within-a-location" class="anchor"></a>Comparing the prevalence of specific lineages within a location</h2>
<div id="accessing-the-data-prevalence-of-particular-variants-over-time-in-the-u-s-" class="section level3">
<h3 class="hasAnchor">
<a href="#accessing-the-data-prevalence-of-particular-variants-over-time-in-the-u-s-" class="anchor"></a>Accessing the data: prevalence of particular variants over time in the U.S.</h3>
<p>To get a better idea of how uncertain the estimates of variant prevalence are, and also to look at the prevalence of variants that aren’t high in prevalence at the moment, we can calculate the prevalence of variants over time with a 95% confidence interval. To view how these data change, we can also use the plotting function <code>plot</code> to replicate the visualization on outbreak.info. Let’s look at the growth and decline of Alpha / B.1.1.7, Episilon / B.1.427 / B.1.429, Iota / B.1.526, and how Delta/B.1.617.2 overtakes them in the Spring of 2021:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The WHO lineages are a Pango lineage with all its sublineages.</span>
<span class="co"># Using `lookupSublineages`, we can lookup all the sublineages associated with the WHO designated sequence, according to the most recent classifications from the Pango team.</span>
<span class="va">alpha_lineages</span> <span class="op">=</span> <span class="fu"><a href="../reference/lookupSublineages.html">lookupSublineages</a></span><span class="op">(</span><span class="st">"Alpha"</span>, returnQueryString <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">epsilon_lineages</span> <span class="op">=</span> <span class="fu"><a href="../reference/lookupSublineages.html">lookupSublineages</a></span><span class="op">(</span><span class="st">"Epsilon"</span>, returnQueryString <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">iota_lineages</span> <span class="op">=</span> <span class="fu"><a href="../reference/lookupSublineages.html">lookupSublineages</a></span><span class="op">(</span><span class="st">"Iota"</span>, returnQueryString <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">delta_lineages</span> <span class="op">=</span> <span class="fu"><a href="../reference/lookupSublineages.html">lookupSublineages</a></span><span class="op">(</span><span class="st">"Delta"</span>, returnQueryString <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># create a label dictionary to rename the lineages by their WHO name:</span>
<span class="co"># If you don't do this, the lineage will be labeled as a really long name of all the Pango lineages like "B.1.617.2 OR AY.1 OR AY.2 ...)"</span>
<span class="va">who_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alpha"</span>, <span class="st">"Epsilon"</span>, <span class="st">"Iota"</span>, <span class="st">"Delta"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">who_labels</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">alpha_lineages</span>, <span class="va">epsilon_lineages</span>, <span class="va">iota_lineages</span>, <span class="va">delta_lineages</span><span class="op">)</span>

<span class="va">who_prevalence</span> <span class="op">=</span> <span class="fu"><a href="../reference/getPrevalence.html">getPrevalence</a></span><span class="op">(</span>pangolin_lineage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">alpha_lineages</span>, <span class="va">epsilon_lineages</span>, <span class="va">iota_lineages</span>, <span class="va">delta_lineages</span><span class="op">)</span>, location <span class="op">=</span> <span class="va">locationName</span><span class="op">)</span></code></pre></div>
<pre><code>## Retrieving data... 
## Retrieving data... 
## Retrieving data... 
## Retrieving data...</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">who_prevalence</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 3,217
## Columns: 10
## $ date                  &lt;date&gt; 2020-03-15, 2020-03-16, 2020-03-17, 2020-03-18,…
## $ total_count           &lt;int&gt; 997, 930, 767, 828, 679, 591, 459, 376, 626, 720…
## $ lineage_count         &lt;int&gt; 5, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ total_count_rolling   &lt;dbl&gt; 440.0000, 545.4286, 627.8571, 711.8571, 754.4286…
## $ lineage_count_rolling &lt;dbl&gt; 0.7142857, 0.7142857, 0.7142857, 0.7142857, 0.85…
## $ proportion            &lt;dbl&gt; 0.0016233766, 0.0013095862, 0.0011376564, 0.0010…
## $ proportion_ci_lower   &lt;dbl&gt; 2.453313e-04, 1.980486e-04, 1.718652e-04, 1.5158…
## $ proportion_ci_upper   &lt;dbl&gt; 0.010572943, 0.008543750, 0.007418311, 0.0065456…
## $ lineage               &lt;chr&gt; "B.1.1.7 OR Q.1 OR Q.2 OR Q.3 OR Q.4 OR Q.5 OR Q…
## $ location              &lt;chr&gt; "United States", "United States", "United States…</code></pre>
</div>
<div id="plotting-specific-variants-over-time" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-specific-variants-over-time" class="anchor"></a>Plotting specific variants over time</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotPrevalenceOverTime.html">plotPrevalenceOverTime</a></span><span class="op">(</span><span class="va">who_prevalence</span>, labelDictionary <span class="op">=</span> <span class="va">who_labels</span><span class="op">)</span></code></pre></div>
<p><img src="locationtracker_files/figure-html/variant_overlay-1.png" width="700"></p>
</div>
<div id="more-advanced-options-specifying-variants-that-arent-lineages" class="section level3">
<h3 class="hasAnchor">
<a href="#more-advanced-options-specifying-variants-that-arent-lineages" class="anchor"></a>More advanced options: specifying variants that aren’t lineages</h3>
<p>It’s easy to gather the prevalence over time for a specific Pango lineage, or a group of Pango lineages, like the ones that make up WHO Variants of Concern and Interest. You can also look at how a particular <strong>mutation</strong> is increasing or decreasing in prevalence or how a <strong>lineage with a specific mutation(s)</strong> is changing. Here, we’ll look at the changes in a particular mutation within Delta (S:Y145H) and compare it’s growth with the mutation S:E484K, which is often found in lineages like B.1.351/Beta and P.1/Gamma, and the combination of S:E484K and S:P681H, which is found in P.1.7.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">delta_y145H</span> <span class="op">=</span> <span class="fu"><a href="../reference/getPrevalence.html">getPrevalence</a></span><span class="op">(</span>pangolin_lineage <span class="op">=</span> <span class="va">delta_lineages</span>, mutations<span class="op">=</span><span class="st">"S:Y145H"</span>, location <span class="op">=</span> <span class="va">locationName</span><span class="op">)</span></code></pre></div>
<pre><code>## Retrieving data...</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e484k</span> <span class="op">=</span> <span class="fu"><a href="../reference/getPrevalence.html">getPrevalence</a></span><span class="op">(</span>mutations<span class="op">=</span><span class="st">"S:E484K"</span>, location <span class="op">=</span> <span class="va">locationName</span><span class="op">)</span></code></pre></div>
<pre><code>## Retrieving data...</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e484k_p618h</span> <span class="op">=</span> <span class="fu"><a href="../reference/getPrevalence.html">getPrevalence</a></span><span class="op">(</span>mutations<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"S:E484K"</span>, <span class="st">"S:P681H"</span><span class="op">)</span>, location <span class="op">=</span> <span class="va">locationName</span><span class="op">)</span></code></pre></div>
<pre><code>## Retrieving data...</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">delta_y145H</span>, <span class="va">e484k</span>, <span class="va">e484k_p618h</span><span class="op">)</span>

<span class="co"># Come up with nicer labels than all the AY.1 lineages exist today</span>
<span class="va">custom_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Delta with Y145H"</span>, <span class="st">"E484K"</span>, <span class="st">"E484K and P681H"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">custom_labels</span><span class="op">)</span> <span class="op">=</span> <span class="va">df</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">lineage</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">lineage</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotPrevalenceOverTime.html">plotPrevalenceOverTime</a></span><span class="op">(</span><span class="va">df</span>, title <span class="op">=</span> <span class="st">"Variant prevalence in the United States"</span>, labelDictionary <span class="op">=</span> <span class="va">custom_labels</span><span class="op">)</span></code></pre></div>
<p><img src="locationtracker_files/figure-html/custom_variants-1.png" width="700"></p>
</div>
<div id="a-slight-variation-comparing-delta-prevalence-across-locations" class="section level3">
<h3 class="hasAnchor">
<a href="#a-slight-variation-comparing-delta-prevalence-across-locations" class="anchor"></a>A slight variation: comparing Delta prevalence across locations</h3>
<p>Instead of comparing the prevalence of variants within a single location, we can also compare the prevalence of one variant across multiple locations. Here, for instance, we plot how the prevalence of all Delta lineages in a few U.S. states has changed over time.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">locations</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="st">"Missouri"</span>, <span class="st">"Kansas"</span>, <span class="st">"California"</span>, <span class="st">"Louisiana"</span><span class="op">)</span>

<span class="va">delta_by_state</span> <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="va">locations</span>, <span class="kw">function</span><span class="op">(</span><span class="va">loc</span><span class="op">)</span> <span class="fu"><a href="../reference/getPrevalence.html">getPrevalence</a></span><span class="op">(</span>pangolin_lineage <span class="op">=</span> <span class="va">delta_lineages</span>, location <span class="op">=</span> <span class="va">loc</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Retrieving data... 
## Retrieving data... 
## Retrieving data... 
## Retrieving data...</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotPrevalenceOverTime.html">plotPrevalenceOverTime</a></span><span class="op">(</span><span class="va">delta_by_state</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;</span> <span class="st">"2021-04-01"</span><span class="op">)</span>, colorVar <span class="op">=</span> <span class="st">"location"</span>, title <span class="op">=</span> <span class="st">"Delta prevalence across locations"</span><span class="op">)</span> </code></pre></div>
<p><img src="locationtracker_files/figure-html/location_overlay-1.png" width="700"></p>
</div>
</div>
<div id="what-mutations-are-contained-within-the-lineages-that-are-circulating-within-the-u-s-" class="section level2">
<h2 class="hasAnchor">
<a href="#what-mutations-are-contained-within-the-lineages-that-are-circulating-within-the-u-s-" class="anchor"></a>What mutations are contained within the lineages that are circulating within the U.S.?</h2>
<p>Using the data we already calculated of the lineages currently circulating in the U.S. (<code>usa_60d</code>), we can compare what mutations commonly occur within these lineages?</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the names of the lineages that have been circulating in the U.S. in the past 60 days</span>
<span class="va">lineages_60d</span> <span class="op">=</span> <span class="va">usa_60d</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">lineage</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Get the mutations that are present in at least 75% of the sequences associated with those lineages.</span>
<span class="va">mutations_60d</span> <span class="op">=</span> <span class="fu"><a href="../reference/getMutationsByLineage.html">getMutationsByLineage</a></span><span class="op">(</span>pangolin_lineage<span class="op">=</span><span class="va">lineages_60d</span>, frequency<span class="op">=</span><span class="fl">0.75</span>, logInfo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Plot a heatmap to compare the mutation prevalence by lineage.</span>
<span class="fu"><a href="../reference/plotMutationHeatmap.html">plotMutationHeatmap</a></span><span class="op">(</span><span class="va">mutations_60d</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"S-gene mutations in lineages circulating within the U.S. in the last 60 days"</span>, subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"As of "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'%d %B %Y'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="locationtracker_files/figure-html/mutation_heatmap-1.png" width="100%"></p>
</div>
<div id="how-prevalent-are-variants-of-concern-within-the-u-s-" class="section level2">
<h2 class="hasAnchor">
<a href="#how-prevalent-are-variants-of-concern-within-the-u-s-" class="anchor"></a>How prevalent are Variants of Concern within the U.S.?</h2>
<p>We can also grab the cumulative prevalence of any variant since the variant was discovered.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the </span>
<span class="va">curated</span> <span class="op">=</span> <span class="fu"><a href="../reference/getCuratedLineages.html">getCuratedLineages</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Pull out the VOCs and the lineages associated with them</span>
<span class="va">vocs</span> <span class="op">=</span> <span class="va">curated</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">variantType</span> <span class="op">==</span> <span class="st">"Variant of Concern"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">who_name</span>, <span class="va">char_muts_parent_query</span><span class="op">)</span>

<span class="co"># Get the cumulative prevalence of each of the VOCs</span>
<span class="va">voc_prev</span> <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="va">vocs</span><span class="op">$</span><span class="va">char_muts_parent_query</span>, <span class="kw">function</span><span class="op">(</span><span class="va">variant</span><span class="op">)</span> <span class="fu"><a href="../reference/getPrevalence.html">getPrevalence</a></span><span class="op">(</span>pangolin_lineage <span class="op">=</span> <span class="va">variant</span>, location <span class="op">=</span> <span class="va">locationName</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Retrieving data... 
## Retrieving data... 
## Retrieving data... 
## Retrieving data... 
## Retrieving data...</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Join back the WHO names, since they're prettier.</span>
<span class="va">voc_prev</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">voc_prev</span>, <span class="va">vocs</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lineage"</span> <span class="op">=</span> <span class="st">"char_muts_parent_query"</span><span class="op">)</span><span class="op">)</span>
<span class="va">voc_prev</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">lineage</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="19%">
<col width="14%">
<col width="15%">
<col width="16%">
<col width="15%">
<col width="11%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="right">value.global_prevalence</th>
<th align="right">value.total_count</th>
<th align="right">value.lineage_count</th>
<th align="left">value.first_detected</th>
<th align="left">value.last_detected</th>
<th align="left">location</th>
<th align="left">who_name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.2743863</td>
<td align="right">3234932</td>
<td align="right">887621</td>
<td align="left">2020-04-03</td>
<td align="left">2022-05-09</td>
<td align="left">United States</td>
<td align="left">Omicron</td>
</tr>
<tr class="even">
<td align="right">0.4525710</td>
<td align="right">3249207</td>
<td align="right">1470497</td>
<td align="left">2020-03-12</td>
<td align="left">2022-04-19</td>
<td align="left">United States</td>
<td align="left">Delta</td>
</tr>
<tr class="odd">
<td align="right">0.0757923</td>
<td align="right">3247746</td>
<td align="right">246154</td>
<td align="left">2020-03-15</td>
<td align="left">2022-03-14</td>
<td align="left">United States</td>
<td align="left">Alpha</td>
</tr>
<tr class="even">
<td align="right">0.0009788</td>
<td align="right">3219145</td>
<td align="right">3151</td>
<td align="left">2020-05-07</td>
<td align="left">2021-12-09</td>
<td align="left">United States</td>
<td align="left">Beta</td>
</tr>
<tr class="odd">
<td align="right">0.0092521</td>
<td align="right">3232766</td>
<td align="right">29910</td>
<td align="left">2020-04-07</td>
<td align="left">2021-12-09</td>
<td align="left">United States</td>
<td align="left">Gamma</td>
</tr>
</tbody>
</table>
</div>
<div id="where-are-the-variants-of-concern-most-prevalent-within-the-u-s-" class="section level2">
<h2 class="hasAnchor">
<a href="#where-are-the-variants-of-concern-most-prevalent-within-the-u-s-" class="anchor"></a>Where are the Variants of Concern most prevalent within the U.S.?</h2>
<p>… and we can break down the prevalence of each lineage by state/province, if you specify a country, or by county if you feed in a state. Let’s look at the prevalence of Delta by state and within California.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate the  prevalence of Delta in the U.S. over the last 90 days</span>
<span class="va">delta_by_state</span> <span class="op">=</span> <span class="fu"><a href="../reference/getCumulativeBySubadmin.html">getCumulativeBySubadmin</a></span><span class="op">(</span>pangolin_lineage <span class="op">=</span> <span class="va">delta_lineages</span>, location <span class="op">=</span> <span class="va">locationName</span>, ndays <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></code></pre></div>
<pre><code>## Retrieving data...</code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate the  prevalence of Delta in California over the last 90 days</span>
<span class="va">delta_in_california</span> <span class="op">=</span> <span class="fu"><a href="../reference/getCumulativeBySubadmin.html">getCumulativeBySubadmin</a></span><span class="op">(</span>pangolin_lineage <span class="op">=</span> <span class="va">delta_lineages</span>, location <span class="op">=</span> <span class="st">"California"</span>, ndays <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></code></pre></div>
<pre><code>## Retrieving data...</code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot the results</span>
<span class="fu"><a href="../reference/plotPrevalenceDotPlot.html">plotPrevalenceDotPlot</a></span><span class="op">(</span><span class="va">delta_by_state</span>, <span class="st">"Delta prevalence over the last 90 days in the United States"</span>, subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"As of "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'%d %B %Y'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 16 rows containing missing values (geom_segment).</code></pre>
<p><img src="locationtracker_files/figure-html/cum_prev_by_state-1.png" width="100%"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotPrevalenceDotPlot.html">plotPrevalenceDotPlot</a></span><span class="op">(</span><span class="va">delta_in_california</span>, <span class="st">"Delta prevalence over the last 90 days in the United States"</span>, subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"As of "</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'%d %B %Y'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 29 rows containing missing values (geom_segment).</code></pre>
<p><img src="locationtracker_files/figure-html/cum_prev_by_state-2.png" width="100%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Manar Alkuzweny, Karthik Gangavarapu, Laura Hughes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
